(defn give
  "Give an item (key, detector or animal) to another player in the same room."
  [item recipient]
  (dosync
   (let [item-key (keyword item)
         recipients @(:inhabitants @player/*current-room*)
         recipient-ref (get @player/player-streams recipient)]
     (cond
       (not (player/carrying? item))
         (str "You're not carrying a " item ".")
       
       (not (contains? recipients recipient))
         (str recipient " is not in this room.")
       
       (nil? recipient-ref)
         (str "Cannot find player data for " recipient ".")
       
       :else
         (do
           (move-between-refs item-key
                            player/*inventory*
                            (deref (get @player/player-refs recipient)))
           (binding [*out* (player/streams recipient)]
             (println (str player/*name* " gave you " item "."))
             (println player/prompt))
           (str "You gave " item " to " recipient "."))))))



(def player-refs (atom {})) ; хранит ref'ы инвентарей игроков
